# 登录跳转测试指南

## 测试前准备
1. 在微信开发者工具中打开项目
2. 清除小程序缓存：工具栏 → 清除缓存 → 清除数据缓存
3. 重新编译项目

## 测试用例

### 测试用例1：普通用户登录
1. **操作**：选择"普通用户"登录
2. **输入**：手机号、密码
3. **点击**：登录按钮
4. **期望结果**：
   - 显示"登录成功"提示
   - 1.5秒后跳转到首页 (`/pages/index/index`)
   - 底部 tabBar 显示：首页、产品、订单、我的
   - Console 输出类似：
     ```
     开始密码登录: { phone: "138xxxx", loginType: "customer" }
     登录成功响应: { token: "xxx", userInfo: {...}, userType: "customer" }
     准备跳转到首页: { userType: "customer", homePage: "/pages/index/index" }
     跳转首页成功: /pages/index/index
     ```

### 测试用例2：客户经理登录
1. **操作**：选择"客户经理"登录
2. **输入**：手机号、密码
3. **点击**：登录按钮
4. **期望结果**：
   - 显示"登录成功"提示
   - 1.5秒后跳转到工作台 (`/pages/manager/workplace/workplace`)
   - 底部 tabBar 显示：工作台、我的客户、跟进管理、业绩查看、我的
   - Console 输出类似：
     ```
     开始密码登录: { phone: "138xxxx", loginType: "manager" }
     登录成功响应: { token: "xxx", userInfo: {...}, userType: "manager" }
     准备跳转到首页: { userType: "manager", homePage: "/pages/manager/workplace/workplace" }
     跳转首页成功: /pages/manager/workplace/workplace
     ```

### 测试用例3：微信登录
1. **操作**：点击"微信登录"
2. **期望结果**：
   - 获取微信授权码
   - 根据后端返回的 userType 跳转到对应页面
   - Console 输出包含授权码信息

### 测试用例4：短信登录
1. **操作**：选择短信登录，获取验证码
2. **输入**：手机号、验证码
3. **期望结果**：
   - 发送验证码成功
   - 登录成功后正确跳转

## 问题排查

### 如果跳转失败
查看 Console 中是否有以下错误信息：
- `跳转首页失败: {...}`
- `使用switchTab跳转首页也失败: {...}`
- `所有跳转方式都失败: {...}`

### 如果跳转到错误页面
1. 检查 `最终用户类型` 是否正确
2. 检查 `获取到的首页路径` 是否正确
3. 验证目标页面是否存在

### 如果 tabBar 显示错误
1. 检查 `开始更新自定义tabbar` 相关日志
2. 确认 `tabbar配置` 是否正确
3. 验证用户类型设置是否成功

## 快速测试命令

在 Console 中可以手动执行以下代码进行测试：

```javascript
// 检查当前用户类型
const { roleManager } = require('./utils/role-manager')
console.log('当前用户类型:', roleManager.getCurrentUserType())

// 检查登录状态
console.log('登录状态:', roleManager.checkLoginStatus())

// 手动跳转到首页
roleManager.navigateToHomePage()
```

## 预期时间线
- 登录按钮点击后 → 立即显示加载状态
- 接口响应后 → 显示"登录成功"提示
- 1.5秒后 → 开始页面跳转
- 跳转完成 → 显示对应的首页和 tabBar 