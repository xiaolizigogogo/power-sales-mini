# 客户经理工作台菜单栏修复说明

## 问题描述

客户经理登录成功后跳转到工作台页面，但是工作台没有显示底部菜单栏，导致用户无法方便地切换到其他功能页面。

## 问题原因

1. **app.json配置不完整**：`tabBar.list` 中只包含了普通客户的页面，没有包含客户经理的页面
2. **页面缺少tabBar更新逻辑**：各个客户经理页面没有正确调用自定义tabBar的更新方法
3. **跳转方式问题**：客户经理页面需要使用`switchTab`进行跳转，但tabBar配置不完整导致跳转失败

## 修复方案

### 1. 修改app.json配置

**文件**: `power-sales-mini/miniprogram/app.json`

**修改内容**：在`tabBar.list`中增加客户经理的页面配置：

```json
{
  "tabBar": {
    "custom": true,
    "color": "#646566",
    "selectedColor": "#1989fa",
    "backgroundColor": "#ffffff",
    "list": [
      // 原有的普通客户页面
      {
        "pagePath": "pages/index/index",
        "text": "首页"
      },
      {
        "pagePath": "pages/products/index/index",
        "text": "产品"
      },
      {
        "pagePath": "pages/orders/index/index",
        "text": "订单"
      },
      {
        "pagePath": "pages/profile/index/index",
        "text": "我的"
      },
      // 新增的客户经理页面
      {
        "pagePath": "pages/manager/workplace/workplace",
        "text": "工作台"
      },
      {
        "pagePath": "pages/manager/customers/list",
        "text": "客户"
      },
      {
        "pagePath": "pages/manager/follow/list",
        "text": "跟进"
      },
      {
        "pagePath": "pages/manager/performance/index",
        "text": "业绩"
      },
      {
        "pagePath": "pages/manager/profile/index",
        "text": "我的"
      }
    ]
  }
}
```

### 2. 修改客户经理页面JS文件

为以下5个客户经理页面都添加了`updateTabBar`方法：

#### 2.1 工作台页面

**文件**: `power-sales-mini/miniprogram/pages/manager/workplace/workplace.js`

**修改内容**：
- 在`onLoad`和`onShow`方法中调用`this.updateTabBar()`
- 添加`updateTabBar()`方法，设置当前选中的tab为0（工作台）

#### 2.2 客户列表页面

**文件**: `power-sales-mini/miniprogram/pages/manager/customers/list.js`

**修改内容**：
- 在`onShow`方法中调用`this.updateTabBar()`
- 添加`updateTabBar()`方法，设置当前选中的tab为1（我的客户）

#### 2.3 跟进管理页面

**文件**: `power-sales-mini/miniprogram/pages/manager/follow/list.js`

**修改内容**：
- 在`onShow`方法中调用`this.updateTabBar()`
- 添加`updateTabBar()`方法，设置当前选中的tab为2（跟进管理）

#### 2.4 业绩查看页面

**文件**: `power-sales-mini/miniprogram/pages/manager/performance/index.js`

**修改内容**：
- 在`onShow`方法中调用`this.updateTabBar()`
- 添加`updateTabBar()`方法，设置当前选中的tab为3（业绩查看）

#### 2.5 个人资料页面

**文件**: `power-sales-mini/miniprogram/pages/manager/profile/index.js`

**修改内容**：
- 在`onShow`方法中调用`this.updateTabBar()`
- 添加`updateTabBar()`方法，设置当前选中的tab为4（我的）

### 3. updateTabBar方法实现

每个页面的`updateTabBar`方法都包含以下内容：

```javascript
/**
 * 更新自定义tabBar
 */
updateTabBar() {
  if (typeof this.getTabBar === 'function' && this.getTabBar()) {
    const tabbar = this.getTabBar();
    const userType = roleManager.getCurrentUserType();
    
    if (userType === 'manager') {
      tabbar.setData({
        list: [
          {
            icon: 'apps-o',
            text: '工作台',
            url: '/pages/manager/workplace/workplace'
          },
          {
            icon: 'friends-o',
            text: '我的客户',
            url: '/pages/manager/customers/list'
          },
          {
            icon: 'edit',
            text: '跟进管理',
            url: '/pages/manager/follow/list'
          },
          {
            icon: 'chart-trending-o',
            text: '业绩查看',
            url: '/pages/manager/performance/index'
          },
          {
            icon: 'user-o',
            text: '我的',
            url: '/pages/manager/profile/index'
          }
        ]
      });
      
      // 设置当前选中的tab（每个页面不同）
      tabbar.setData({
        active: 0  // 工作台=0, 客户=1, 跟进=2, 业绩=3, 我的=4
      });
    }
  }
}
```

## 修复效果

### 修复前
1. 客户经理登录后跳转到工作台页面
2. 工作台页面没有底部菜单栏显示
3. 无法方便切换到其他功能页面

### 修复后
1. 客户经理登录后跳转到工作台页面
2. 工作台页面正确显示底部菜单栏，包含5个功能选项：
   - 工作台（当前选中）
   - 我的客户
   - 跟进管理
   - 业绩查看
   - 我的
3. 点击底部菜单栏可以正常切换到对应页面
4. 每个页面都能正确显示底部菜单栏并标记当前选中状态

## 技术要点

1. **自定义tabBar配置**：微信小程序使用自定义tabBar时，需要在app.json中配置所有可能的tabBar页面
2. **动态更新tabBar**：根据用户类型动态设置tabBar的显示内容和选中状态
3. **页面生命周期**：在页面的onShow方法中调用updateTabBar，确保每次进入页面时都能正确显示
4. **权限控制**：只有客户经理类型的用户才会显示客户经理专用的tabBar

## 测试建议

1. 清除小程序缓存，重新登录客户经理账号
2. 验证登录后是否正确跳转到工作台并显示底部菜单栏
3. 逐个点击底部菜单栏的5个选项，验证是否能正常跳转和显示
4. 验证每个页面的菜单栏选中状态是否正确
5. 验证普通客户登录后不受影响，仍然显示原有的tabBar

## 备注

此次修复确保了客户经理能够正常使用底部菜单栏进行页面切换，提升了用户体验。同时保持了与普通客户页面的兼容性。 