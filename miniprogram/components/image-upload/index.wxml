<!-- components/image-upload/index.wxml -->
<view class="image-upload-container {{customClass}}">
  <!-- ç½‘æ ¼æ¨¡å¼ -->
  <view class="image-grid" wx:if="{{previewMode === 'grid' || previewMode === 'default'}}">
    <!-- å·²ä¸Šä¼ å›¾ç‰‡åˆ—è¡¨ -->
    <view 
      class="image-item"
      wx:for="{{imageList}}"
      wx:key="id"
      data-index="{{index}}"
      bindtap="previewImage"
    >
      <image 
        class="image-preview"
        src="{{item.thumbUrl || item.url}}"
        mode="aspectFill"
        lazy-load="{{true}}"
      />
      
      <!-- åˆ é™¤æŒ‰é’® -->
      <view 
        class="delete-btn" 
        wx:if="{{showDelete && !disabled}}"
        data-index="{{index}}"
        bindtap="deleteImage"
        catchtap="true"
      >
        <text class="delete-icon">âœ•</text>
      </view>
      
      <!-- åŠ è½½çŠ¶æ€ -->
      <view class="loading-mask" wx:if="{{item.loading}}">
        <text class="loading-text">ä¸Šä¼ ä¸­...</text>
      </view>
      
      <!-- é”™è¯¯çŠ¶æ€ -->
      <view class="error-mask" wx:if="{{item.error}}">
        <text class="error-text">ä¸Šä¼ å¤±è´¥</text>
        <view 
          class="retry-btn"
          data-index="{{index}}"
          bindtap="retryUpload"
          catchtap="true"
        >
          é‡è¯•
        </view>
      </view>
    </view>
    
    <!-- ä¸Šä¼ æŒ‰é’® -->
    <view 
      class="upload-btn"
      wx:if="{{showUploadBtn && imageList.length < maxCount && !disabled}}"
      bindtap="chooseImage"
    >
      <view class="upload-icon">
        <text class="icon">ğŸ“·</text>
      </view>
      <text class="upload-text">{{uploadText}}</text>
      <text class="upload-count">{{imageList.length}}/{{maxCount}}</text>
    </view>
  </view>
  
  <!-- åˆ—è¡¨æ¨¡å¼ -->
  <view class="image-list" wx:if="{{previewMode === 'list'}}">
    <!-- å·²ä¸Šä¼ å›¾ç‰‡åˆ—è¡¨ -->
    <view 
      class="list-item"
      wx:for="{{imageList}}"
      wx:key="id"
    >
      <image 
        class="list-image"
        src="{{item.thumbUrl || item.url}}"
        mode="aspectFill"
        data-index="{{index}}"
        bindtap="previewImage"
      />
      
      <view class="list-content">
        <text class="list-name">å›¾ç‰‡{{index + 1}}</text>
        <text class="list-time">{{item.uploadTime}}</text>
        
        <!-- è¿›åº¦æ¡ -->
        <view class="progress-bar" wx:if="{{item.loading && showProgress}}">
          <view class="progress-fill" style="width: {{item.progress || 0}}%"></view>
        </view>
        
        <!-- çŠ¶æ€æ–‡å­— -->
        <text class="list-status" wx:if="{{item.loading}}">ä¸Šä¼ ä¸­...</text>
        <text class="list-status error" wx:if="{{item.error}}">ä¸Šä¼ å¤±è´¥</text>
      </view>
      
      <view class="list-actions">
        <!-- é‡è¯•æŒ‰é’® -->
        <view 
          class="action-btn retry"
          wx:if="{{item.error}}"
          data-index="{{index}}"
          bindtap="retryUpload"
        >
          é‡è¯•
        </view>
        
        <!-- åˆ é™¤æŒ‰é’® -->
        <view 
          class="action-btn delete"
          wx:if="{{showDelete && !disabled}}"
          data-index="{{index}}"
          bindtap="deleteImage"
        >
          åˆ é™¤
        </view>
      </view>
    </view>
    
    <!-- ä¸Šä¼ æŒ‰é’® -->
    <view 
      class="list-upload-btn"
      wx:if="{{showUploadBtn && imageList.length < maxCount && !disabled}}"
      bindtap="chooseImage"
    >
      <view class="upload-icon">
        <text class="icon">â•</text>
      </view>
      <view class="upload-content">
        <text class="upload-title">{{uploadText}}</text>
        <text class="upload-desc">æ”¯æŒJPGã€PNGæ ¼å¼ï¼Œå•ä¸ªæ–‡ä»¶ä¸è¶…è¿‡{{maxSize}}MB</text>
      </view>
    </view>
  </view>
  
  <!-- å…¨å±€ä¸Šä¼ è¿›åº¦ -->
  <view class="global-progress" wx:if="{{uploading && showProgress}}">
    <view class="progress-header">
      <text class="progress-title">æ­£åœ¨ä¸Šä¼ å›¾ç‰‡...</text>
      <text class="progress-percent">{{uploadProgress}}%</text>
    </view>
    <view class="progress-bar">
      <view class="progress-fill" style="width: {{uploadProgress}}%"></view>
    </view>
  </view>
  
  <!-- æç¤ºä¿¡æ¯ -->
  <view class="upload-tips" wx:if="{{showTips && tips}}">
    <text class="tips-text">{{tips}}</text>
  </view>
  
  <!-- é”™è¯¯ä¿¡æ¯ -->
  <view class="error-tips" wx:if="{{errorMessage}}">
    <text class="error-text">{{errorMessage}}</text>
  </view>
</view>

<!-- å›¾ç‰‡é¢„è§ˆå¼¹çª— -->
<view class="preview-modal" wx:if="{{previewVisible}}" bindtap="closePreview">
  <view class="preview-container" catchtap="stopPropagation">
    <view class="preview-header">
      <text class="preview-title">å›¾ç‰‡é¢„è§ˆ ({{previewIndex + 1}}/{{imageList.length}})</text>
      <view class="preview-close" bindtap="closePreview">
        <text class="close-icon">âœ•</text>
      </view>
    </view>
    
    <swiper 
      class="preview-swiper"
      current="{{previewIndex}}"
      bindchange="onPreviewChange"
      indicator-dots="{{imageList.length > 1}}"
      indicator-color="rgba(255,255,255,0.5)"
      indicator-active-color="#ffffff"
    >
      <swiper-item wx:for="{{imageList}}" wx:key="id">
        <image 
          class="preview-image"
          src="{{item.url}}"
          mode="aspectFit"
          bindload="onPreviewImageLoad"
          binderror="onPreviewImageError"
        />
      </swiper-item>
    </swiper>
    
    <view class="preview-actions" wx:if="{{imageList.length > 1}}">
      <view 
        class="action-item"
        bindtap="prevImage"
        disabled="{{previewIndex === 0}}"
      >
        <text class="action-text">ä¸Šä¸€å¼ </text>
      </view>
      <view 
        class="action-item"
        bindtap="nextImage"
        disabled="{{previewIndex === imageList.length - 1}}"
      >
        <text class="action-text">ä¸‹ä¸€å¼ </text>
      </view>
    </view>
  </view>
</view> 