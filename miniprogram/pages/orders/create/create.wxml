<view class="container">
  <!-- 加载状态 -->
  <van-loading wx:if="{{ loading }}" custom-class="page-loading" />

  <block wx:else>
    <!-- 产品信息 -->
    <view class="product-info">
      <image class="product-image" src="{{ product.image }}" mode="aspectFill"/>
      <view class="product-detail">
        <view class="product-name">{{ product.name }}</view>
        <view class="product-price">
          <text class="price-label">电价：</text>
          <text class="price-value">¥{{ product.price }}/度</text>
        </view>
      </view>
    </view>

    <!-- 表单区域 -->
    <view class="form-section">
      <van-cell-group>
        <!-- 用电地址 -->
        <van-field
          value="{{ form.address }}"
          required
          clearable
          label="用电地址"
          placeholder="请输入用电地址"
          bind:change="onInput"
          data-field="address"
        />

        <!-- 联系人 -->
        <van-field
          value="{{ form.contactName }}"
          required
          clearable
          label="联系人"
          placeholder="请输入联系人姓名"
          bind:change="onInput"
          data-field="contactName"
        />

        <!-- 联系电话 -->
        <van-field
          value="{{ form.contactPhone }}"
          required
          clearable
          type="number"
          label="联系电话"
          placeholder="请输入联系电话"
          bind:change="onInput"
          data-field="contactPhone"
        />

        <!-- 用电容量 -->
        <van-field
          value="{{ form.capacity }}"
          required
          clearable
          type="digit"
          label="用电容量"
          placeholder="请输入用电容量(kW)"
          bind:change="onInput"
          data-field="capacity"
        >
          <text slot="right-icon">kW</text>
        </van-field>

        <!-- 电压等级 -->
        <van-field
          value="{{ form.voltage }}"
          required
          readonly
          label="电压等级"
          placeholder="请选择电压等级"
          bindtap="showVoltagePopup"
        />

        <!-- 用电类型 -->
        <van-field
          value="{{ form.type }}"
          required
          readonly
          label="用电类型"
          placeholder="请选择用电类型"
          bindtap="showTypePopup"
        />

        <!-- 服务期限 -->
        <van-field
          value="{{ form.period }}"
          required
          readonly
          label="服务期限"
          placeholder="请选择服务期限"
          bindtap="showPeriodPopup"
        />
      </van-cell-group>

      <!-- 备注信息 -->
      <van-field
        value="{{ form.remark }}"
        type="textarea"
        autosize
        label="备注信息"
        placeholder="请输入备注信息（选填）"
        bind:change="onInput"
        data-field="remark"
      />
    </view>

    <!-- 协议确认 -->
    <view class="agreement-section">
      <van-checkbox 
        value="{{ agreed }}" 
        bind:change="onAgreementChange"
        icon-size="32rpx"
        checked-color="#409EFF"
      >
        我已阅读并同意
      </van-checkbox>
      <text class="agreement-link" bindtap="viewAgreement">《用电服务协议》</text>
    </view>

    <!-- 底部操作栏 -->
    <view class="bottom-bar">
      <view class="price-info">
        <text class="label">预计每月电费</text>
        <text class="value">¥{{ estimatedBill }}</text>
      </view>
      <button 
        class="submit-btn {{ agreed ? 'active' : '' }}" 
        disabled="{{ !agreed }}"
        bindtap="submitOrder"
      >提交订单</button>
    </view>

    <!-- 电压等级选择器 -->
    <van-popup 
      show="{{ showVoltagePopup }}" 
      position="bottom"
      bind:close="closeVoltagePopup"
    >
      <van-picker
        show-toolbar
        title="选择电压等级"
        columns="{{ voltageOptions }}"
        bind:cancel="closeVoltagePopup"
        bind:confirm="onVoltageConfirm"
      />
    </van-popup>

    <!-- 用电类型选择器 -->
    <van-popup 
      show="{{ showTypePopup }}" 
      position="bottom"
      bind:close="closeTypePopup"
    >
      <van-picker
        show-toolbar
        title="选择用电类型"
        columns="{{ typeOptions }}"
        bind:cancel="closeTypePopup"
        bind:confirm="onTypeConfirm"
      />
    </van-popup>

    <!-- 服务期限选择器 -->
    <van-popup 
      show="{{ showPeriodPopup }}" 
      position="bottom"
      bind:close="closePeriodPopup"
    >
      <van-picker
        show-toolbar
        title="选择服务期限"
        columns="{{ periodOptions }}"
        bind:cancel="closePeriodPopup"
        bind:confirm="onPeriodConfirm"
      />
    </van-popup>
  </block>
</view> 