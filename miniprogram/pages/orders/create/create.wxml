<view class="order-create">
  <!-- 加载状态 -->
  <van-loading wx:if="{{ loading }}" custom-class="page-loading" />

  <block wx:else>
    <!-- 产品信息 -->
    <view class="product-card">
      <image class="product-image" src="{{ product.image }}" mode="aspectFill" />
      <view class="product-info">
        <view class="product-name">{{ product.name }}</view>
        <view class="product-price">
          <text class="price">{{ product.price }}</text>
          <text class="unit">元/kWh</text>
        </view>
      </view>
    </view>

    <!-- 订单表单 -->
    <view class="form-section">
      <!-- 服务期限 -->
      <view class="form-item">
        <view class="form-label">服务期限</view>
        <van-radio-group value="{{ orderForm.servicePeriod }}" bind:change="onPeriodChange">
          <van-radio
            wx:for="{{ periodOptions }}"
            wx:key="value"
            name="{{ item.value }}"
            custom-class="period-radio"
          >
            {{ item.text }}
          </van-radio>
        </van-radio-group>
        <view class="error-text" wx:if="{{ errors.servicePeriod }}">
          {{ errors.servicePeriod }}
        </view>
      </view>

      <!-- 服务开始时间 -->
      <view class="form-item">
        <view class="form-label">服务开始时间</view>
        <view class="date-picker" bind:tap="showDatePicker">
          <text>{{ orderForm.startDate || '请选择开始时间' }}</text>
          <van-icon name="arrow" />
        </view>
        <view class="error-text" wx:if="{{ errors.startDate }}">
          {{ errors.startDate }}
        </view>
      </view>

      <!-- 预估用电量 -->
      <view class="form-item">
        <view class="form-label">预估月用电量(kWh)</view>
        <van-field
          value="{{ orderForm.estimatedUsage }}"
          type="digit"
          placeholder="请输入预估月用电量"
          border="{{ false }}"
          bind:change="onInput"
          data-field="estimatedUsage"
        />
        <view class="error-text" wx:if="{{ errors.estimatedUsage }}">
          {{ errors.estimatedUsage }}
        </view>
      </view>

      <!-- 特殊需求 -->
      <view class="form-item">
        <view class="form-label">特殊需求（选填）</view>
        <van-field
          value="{{ orderForm.specialRequirements }}"
          type="textarea"
          placeholder="请输入特殊需求"
          autosize
          border="{{ false }}"
          bind:change="onInput"
          data-field="specialRequirements"
        />
      </view>

      <!-- 备注 -->
      <view class="form-item">
        <view class="form-label">备注（选填）</view>
        <van-field
          value="{{ orderForm.remarks }}"
          type="textarea"
          placeholder="请输入备注信息"
          autosize
          border="{{ false }}"
          bind:change="onInput"
          data-field="remarks"
        />
      </view>
    </view>

    <!-- 费用预估 -->
    <view class="fee-section">
      <view class="section-title">费用预估</view>
      
      <view class="fee-item">
        <text>月均费用</text>
        <view class="fee-value">
          <text class="amount">{{ orderForm.monthlyFee }}</text>
          <text class="unit">元</text>
        </view>
      </view>

      <view class="fee-item">
        <text>服务期总费用</text>
        <view class="fee-value highlight">
          <text class="amount">{{ orderForm.totalAmount }}</text>
          <text class="unit">元</text>
        </view>
      </view>

      <view class="fee-tips">
        * 实际费用以实际用电量为准
      </view>
    </view>

    <!-- 提交按钮 -->
    <view class="submit-section">
      <van-button 
        type="primary" 
        block 
        loading="{{ submitting }}"
        bind:click="submitOrder"
      >
        提交订单
      </van-button>
    </view>
  </block>

  <!-- 日期选择器 -->
  <van-popup
    show="{{ showDatePicker }}"
    position="bottom"
    bind:close="closeDatePicker"
  >
    <van-datetime-picker
      type="date"
      value="{{ currentDate }}"
      min-date="{{ minDate }}"
      max-date="{{ maxDate }}"
      bind:confirm="onDateConfirm"
      bind:cancel="closeDatePicker"
    />
  </van-popup>
</view> 