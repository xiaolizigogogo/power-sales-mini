<view class="contracts-list">
  <!-- 页面头部 -->
  <view class="page-header">
    <view class="header-title">我的合同</view>
    <view class="header-actions">
      <van-icon name="search" bind:click="showSearch" />
      <van-icon name="replay" bind:click="refreshData" />
    </view>
  </view>

  <!-- 搜索栏 -->
  <view class="search-section" wx:if="{{ showSearchBar }}">
    <view class="search-bar">
      <van-field
        value="{{ searchKeyword }}"
        placeholder="搜索合同编号、产品名称"
        bind:change="onSearchInput"
        bind:confirm="onSearchConfirm"
        bind:clear="onSearchClear"
        clearable
        border="{{ false }}"
      >
        <van-icon slot="left-icon" name="search" />
      </van-field>
    </view>
  </view>

  <!-- 标签页 -->
  <van-tabs 
    active="{{ activeTab }}" 
    bind:change="onTabChange"
    sticky
    swipeable
  >
    <van-tab 
      wx:for="{{ tabs }}" 
      wx:key="key"
      name="{{ item.key }}"
      title="{{ item.name }}"
      badge="{{ item.count > 0 ? item.count : '' }}"
    >
      <!-- 合同列表 -->
      <view class="contract-container">
        <!-- 加载状态 -->
        <view class="loading-container" wx:if="{{ loading }}">
          <van-loading type="spinner" color="#1989fa" />
          <text class="loading-text">加载中...</text>
        </view>

        <!-- 空状态 -->
        <view class="empty-container" wx:elif="{{ ordersWithContracts.length === 0 }}">
          <van-empty 
            image="search" 
            description="暂无合同数据"
          />
        </view>

        <!-- 合同列表 -->
             <view class="contract-list" wx:else>
          <block wx:for="{{ordersWithContracts}}" wx:key="order.id">
            <view class="order-contract-block">
              <view class="order-header">
                订单号：{{item.order.orderNo}} | 服务地址：{{item.order.serviceAddress}} | 金额：¥{{item.order.amount}}
              </view>
              <view class="contract-img-list">
                <block wx:for="{{item.contracts}}" wx:key="contract.id">
                  <image class="contract-img"
                         src="{{item.fileUrl}}"
                         mode="aspectFill"
                         bindtap="onPreviewContractImg"
                         data-url="{{item.fileUrl}}"
                         data-index="{{index}}" />
                </block>
              </view>
            </view>
          </block>
        </view>

        <!-- 加载更多 -->
        <view class="load-more" wx:if="{{ hasMore && !loading }}">
          <van-button 
            type="default" 
            size="small" 
            loading="{{ loadingMore }}"
            bind:click="loadMoreContracts"
          >
            {{ loadingMore ? '加载中...' : '加载更多' }}
          </van-button>
        </view>

        <!-- 没有更多 -->
        <view class="no-more" wx:if="{{ !hasMore && contracts.length > 0 }}">
          <text class="no-more-text">已显示全部合同</text>
        </view>
      </view>
    </van-tab>
  </van-tabs>
</view> 