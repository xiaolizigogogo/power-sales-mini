<view class="contracts-list">
  <!-- 页面头部 -->
  <view class="page-header">
    <view class="header-title">我的合同</view>
    <view class="header-actions">
      <van-icon name="search" bind:click="showSearch" />
      <van-icon name="replay" bind:click="refreshData" />
    </view>
  </view>

  <!-- 搜索栏 -->
  <view class="search-section" wx:if="{{ showSearchBar }}">
    <view class="search-bar">
      <van-field
        value="{{ searchKeyword }}"
        placeholder="搜索合同编号、产品名称"
        bind:change="onSearchInput"
        bind:confirm="onSearchConfirm"
        bind:clear="onSearchClear"
        clearable
        border="{{ false }}"
      >
        <van-icon slot="left-icon" name="search" />
      </van-field>
    </view>
  </view>

  <!-- 标签页 -->
  <van-tabs 
    active="{{ activeTab }}" 
    bind:change="onTabChange"
    sticky
    swipeable
  >
    <van-tab 
      wx:for="{{ tabs }}" 
      wx:key="key"
      name="{{ item.key }}"
      title="{{ item.name }}"
      badge="{{ item.count > 0 ? item.count : '' }}"
    >
      <!-- 合同列表 -->
      <view class="contract-container">
        <!-- 加载状态 -->
        <view class="loading-container" wx:if="{{ loading }}">
          <van-loading type="spinner" color="#1989fa" />
          <text class="loading-text">加载中...</text>
        </view>

        <!-- 空状态 -->
        <view class="empty-container" wx:elif="{{ contracts.length === 0 }}">
          <van-empty 
            image="search" 
            description="暂无合同数据"
          />
        </view>

        <!-- 合同列表 -->
        <view class="contract-list" wx:else>
          <view 
            class="contract-card"
            wx:for="{{ contracts }}"
            wx:key="id"
            bind:tap="viewContractDetail"
            data-id="{{ item.id }}"
          >
            <!-- 合同头部 -->
            <view class="contract-header">
              <view class="contract-no">{{ item.contractNo }}</view>
              <view 
                class="contract-status"
                style="color: {{ statusMap[item.status].color }}"
              >
                {{ statusMap[item.status].text }}
              </view>
            </view>

            <!-- 合同信息 -->
            <view class="contract-info">
              <view class="info-item">
                <text class="label">订单编号</text>
                <text class="value">{{ item.orderNo }}</text>
              </view>
              <view class="info-item">
                <text class="label">产品名称</text>
                <text class="value">{{ item.productName }}</text>
              </view>
              <view class="info-item">
                <text class="label">服务期限</text>
                <text class="value">{{ item.servicePeriod }}个月</text>
              </view>
              <view class="info-item">
                <text class="label">合同金额</text>
                <text class="value highlight">¥{{ item.amount }}</text>
              </view>
              <view class="info-item">
                <text class="label">服务地址</text>
                <text class="value">{{ item.serviceAddress }}</text>
              </view>
            </view>

            <!-- 时间信息 -->
            <view class="contract-time">
              <view class="time-item">
                <text class="label">创建时间</text>
                <text class="value">{{ item.createTime }}</text>
              </view>
              <view class="time-item" wx:if="{{ item.signedTime }}">
                <text class="label">签署时间</text>
                <text class="value">{{ item.signedTime }}</text>
              </view>
              <view class="time-item" wx:if="{{ item.expireTime }}">
                <text class="label">到期时间</text>
                <text class="value">{{ item.expireTime }}</text>
              </view>
            </view>

            <!-- 状态说明 -->
            <view class="status-desc">
              <text class="desc-text">{{ statusDescMap[item.status] }}</text>
            </view>

            <!-- 操作按钮 -->
            <view class="contract-actions">
              <van-button 
                type="default" 
                size="small" 
                bind:click="downloadContract"
                data-id="{{ item.id }}"
                catch:tap="downloadContract"
              >
                下载合同
              </van-button>
              
              <van-button 
                wx:if="{{ item.status === 'pending' }}"
                type="primary" 
                size="small" 
                bind:click="signContract"
                data-id="{{ item.id }}"
                catch:tap="signContract"
              >
                立即签署
              </van-button>
              
              <van-button 
                wx:if="{{ item.status === 'signed' }}"
                type="info" 
                size="small" 
                bind:click="uploadSignedContract"
                data-id="{{ item.id }}"
                catch:tap="uploadSignedContract"
              >
                上传签署文件
              </van-button>
            </view>
          </view>
        </view>

        <!-- 加载更多 -->
        <view class="load-more" wx:if="{{ hasMore && !loading }}">
          <van-button 
            type="default" 
            size="small" 
            loading="{{ loadingMore }}"
            bind:click="loadMoreContracts"
          >
            {{ loadingMore ? '加载中...' : '加载更多' }}
          </van-button>
        </view>

        <!-- 没有更多 -->
        <view class="no-more" wx:if="{{ !hasMore && contracts.length > 0 }}">
          <text class="no-more-text">已显示全部合同</text>
        </view>
      </view>
    </van-tab>
  </van-tabs>
</view> 