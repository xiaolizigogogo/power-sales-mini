<view class="maintenance-page">
  <!-- é¡¶éƒ¨ç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-section">
    <view class="stats-grid">
      <view class="stat-card">
        <view class="stat-icon">ğŸ“</view>
        <view class="stat-number">{{statistics.todayVisits}}</view>
        <view class="stat-label">ä»Šæ—¥å›è®¿</view>
      </view>
      <view class="stat-card">
        <view class="stat-icon">â°</view>
        <view class="stat-number">{{statistics.pendingVisits}}</view>
        <view class="stat-label">å¾…å›è®¿</view>
      </view>
      <view class="stat-card">
        <view class="stat-icon">ğŸ¯</view>
        <view class="stat-number">{{statistics.monthlyTarget}}%</view>
        <view class="stat-label">æœˆåº¦å®Œæˆç‡</view>
      </view>
      <view class="stat-card">
        <view class="stat-icon">ğŸ˜Š</view>
        <view class="stat-number">{{statistics.satisfaction}}</view>
        <view class="stat-label">æ»¡æ„åº¦</view>
      </view>
    </view>
  </view>

  <!-- åŠŸèƒ½å¯¼èˆª -->
  <view class="nav-section">
    <view class="nav-grid">
      <view class="nav-item" bind:tap="goToVisitPlan">
        <view class="nav-icon">ğŸ“…</view>
        <view class="nav-title">å›è®¿è®¡åˆ’</view>
        <view class="nav-desc">è®¾ç½®å®šæœŸå›è®¿</view>
      </view>
      <view class="nav-item" bind:tap="goToValueServices">
        <view class="nav-icon">ğŸ’</view>
        <view class="nav-title">å¢å€¼æœåŠ¡</view>
        <view class="nav-desc">æ¨å¹¿æ–°äº§å“</view>
      </view>
      <view class="nav-item" bind:tap="goToIssueTracking">
        <view class="nav-icon">ğŸ”§</view>
        <view class="nav-title">é—®é¢˜å¤„ç†</view>
        <view class="nav-desc">å®¢æˆ·é—®é¢˜è·Ÿè¸ª</view>
      </view>
      <view class="nav-item" bind:tap="goToAnalytics">
        <view class="nav-icon">ğŸ“Š</view>
        <view class="nav-title">ç»´æŠ¤åˆ†æ</view>
        <view class="nav-desc">ç»´æŠ¤æ•ˆæœåˆ†æ</view>
      </view>
    </view>
  </view>

  <!-- ä»Šæ—¥ä»»åŠ¡ -->
  <view class="section">
    <view class="section-header">
      <view class="section-title">ä»Šæ—¥ä»»åŠ¡</view>
      <view class="section-more" bind:tap="viewAllTasks">æŸ¥çœ‹å…¨éƒ¨</view>
    </view>
    <view class="task-list">
      <block wx:if="{{todayTasks.length > 0}}">
        <view 
          wx:for="{{todayTasks}}" 
          wx:key="id"
          class="task-card"
          bind:tap="onTaskTap"
          data-task="{{item}}"
        >
          <view class="task-header">
            <view class="task-type">
              <view class="type-icon" style="background-color: {{getTaskTypeColor(item.type)}}">
                {{getTaskTypeIcon(item.type)}}
              </view>
              <view class="type-text">{{getTaskTypeText(item.type)}}</view>
            </view>
            <view class="task-time">{{item.scheduledTime}}</view>
          </view>
          <view class="task-content">
            <view class="customer-info">
              <view class="customer-name">{{item.customerName}}</view>
              <view class="customer-company">{{item.companyName}}</view>
            </view>
            <view class="task-desc">{{item.description}}</view>
          </view>
          <view class="task-actions">
            <view 
              class="action-btn secondary"
              bind:tap="onTaskCall"
              data-task="{{item}}"
            >
              <van-icon name="phone-o" />
              <text>è”ç³»</text>
            </view>
            <view 
              class="action-btn primary"
              bind:tap="onTaskComplete"
              data-task="{{item}}"
            >
              <van-icon name="success" />
              <text>å®Œæˆ</text>
            </view>
          </view>
        </view>
      </block>
      
      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-tasks" wx:if="{{todayTasks.length === 0}}">
        <van-empty description="ä»Šæ—¥æš‚æ— ç»´æŠ¤ä»»åŠ¡">
          <van-button 
            type="primary" 
            size="small"
            bind:click="createNewTask"
          >åˆ›å»ºä»»åŠ¡</van-button>
        </van-empty>
      </view>
    </view>
  </view>

  <!-- æœ€è¿‘å›è®¿è®°å½• -->
  <view class="section">
    <view class="section-header">
      <view class="section-title">æœ€è¿‘å›è®¿</view>
      <view class="section-more" bind:tap="viewAllVisits">æŸ¥çœ‹å…¨éƒ¨</view>
    </view>
    <view class="visit-list">
      <block wx:if="{{recentVisits.length > 0}}">
        <view 
          wx:for="{{recentVisits}}" 
          wx:key="id"
          class="visit-card"
          bind:tap="onVisitTap"
          data-visit="{{item}}"
        >
          <view class="visit-header">
            <view class="customer-info">
              <view class="customer-avatar">
                <image src="{{item.customerAvatar || '/assets/images/default-avatar.png'}}" mode="aspectFill" />
              </view>
              <view class="customer-detail">
                <view class="customer-name">{{item.customerName}}</view>
                <view class="visit-time">{{item.visitTime}}</view>
              </view>
            </view>
            <view class="visit-status">
              <view 
                class="status-badge"
                style="background-color: {{getVisitStatusColor(item.status)}}"
              >{{getVisitStatusText(item.status)}}</view>
            </view>
          </view>
          <view class="visit-content">
            <view class="visit-type">{{getVisitTypeText(item.type)}}</view>
            <view class="visit-summary">{{item.summary}}</view>
          </view>
          <view class="visit-result" wx:if="{{item.satisfactionScore}}">
            <view class="satisfaction">
              <text class="label">æ»¡æ„åº¦ï¼š</text>
              <van-rate 
                value="{{item.satisfactionScore}}" 
                size="16" 
                readonly
                color="#ffd21e"
              />
            </view>
          </view>
        </view>
      </block>
      
      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-visits" wx:if="{{recentVisits.length === 0}}">
        <van-empty description="æš‚æ— å›è®¿è®°å½•" />
      </view>
    </view>
  </view>

  <!-- å¿«é€Ÿæ“ä½œ -->
  <view class="quick-actions">
    <view class="action-row">
      <view class="quick-btn" bind:tap="quickVisit">
        <van-icon name="phone-circle-o" />
        <text>å¿«é€Ÿå›è®¿</text>
      </view>
      <view class="quick-btn" bind:tap="scheduleVisit">
        <van-icon name="calendar-o" />
        <text>å®‰æ’å›è®¿</text>
      </view>
      <view class="quick-btn" bind:tap="promoteService">
        <van-icon name="gift-o" />
        <text>æ¨å¹¿æœåŠ¡</text>
      </view>
      <view class="quick-btn" bind:tap="reportIssue">
        <van-icon name="warning-o" />
        <text>é—®é¢˜ä¸ŠæŠ¥</text>
      </view>
    </view>
    <view class="action-row">
      <view class="quick-btn" bind:tap="openRenewalManagement">
        <van-icon name="bookmark-o" />
        <text>ç»­çº¦ç®¡ç†</text>
      </view>
    </view>
  </view>

  <!-- å¿«é€Ÿå›è®¿å¼¹çª— -->
  <van-dialog
    use-slot
    title="å¿«é€Ÿå›è®¿"
    show="{{ showQuickVisitDialog }}"
    bind:close="closeQuickVisitDialog"
    confirmButtonText="å®Œæˆå›è®¿"
    bind:confirm="confirmQuickVisit"
  >
    <view class="quick-visit-dialog">
      <view class="form-item">
        <text class="form-label">é€‰æ‹©å®¢æˆ·</text>
        <van-field
          value="{{ quickVisitForm.customerName }}"
          placeholder="è¯·é€‰æ‹©å®¢æˆ·"
          readonly
          is-link
          bind:click="selectCustomer"
        />
      </view>
      
      <view class="form-item">
        <text class="form-label">å›è®¿æ–¹å¼</text>
        <van-field
          value="{{ quickVisitForm.typeText }}"
          placeholder="é€‰æ‹©å›è®¿æ–¹å¼"
          readonly
          is-link
          bind:click="selectVisitType"
        />
      </view>
      
      <view class="form-item">
        <text class="form-label">å›è®¿å†…å®¹</text>
        <van-field
          value="{{ quickVisitForm.content }}"
          type="textarea"
          placeholder="è¯·è¾“å…¥å›è®¿å†…å®¹"
          autosize
          bind:change="onQuickVisitInput"
          data-field="content"
        />
      </view>
      
      <view class="form-item">
        <text class="form-label">å®¢æˆ·æ»¡æ„åº¦</text>
        <view class="satisfaction-input">
          <van-rate
            value="{{ quickVisitForm.satisfaction }}"
            size="24"
            bind:change="onSatisfactionChange"
          />
          <text class="satisfaction-text">{{getSatisfactionText(quickVisitForm.satisfaction)}}</text>
        </view>
      </view>
      
      <view class="form-item">
        <text class="form-label">é—®é¢˜åé¦ˆ</text>
        <van-field
          value="{{ quickVisitForm.issues }}"
          type="textarea"
          placeholder="è®°å½•å®¢æˆ·åé¦ˆçš„é—®é¢˜ï¼ˆå¯é€‰ï¼‰"
          autosize
          bind:change="onQuickVisitInput"
          data-field="issues"
        />
      </view>
    </view>
  </van-dialog>

  <!-- å®‰æ’å›è®¿å¼¹çª— -->
  <van-dialog
    use-slot
    title="å®‰æ’å›è®¿"
    show="{{ showScheduleVisitDialog }}"
    bind:close="closeScheduleVisitDialog"
    confirmButtonText="ç¡®è®¤å®‰æ’"
    bind:confirm="confirmScheduleVisit"
  >
    <view class="schedule-visit-dialog">
      <view class="form-item">
        <text class="form-label">é€‰æ‹©å®¢æˆ·</text>
        <van-field
          value="{{ scheduleVisitForm.customerName }}"
          placeholder="è¯·é€‰æ‹©å®¢æˆ·"
          readonly
          is-link
          bind:click="selectCustomerForSchedule"
        />
      </view>
      
      <view class="form-item">
        <text class="form-label">å›è®¿æ—¶é—´</text>
        <van-field
          value="{{ scheduleVisitForm.visitTime }}"
          placeholder="é€‰æ‹©å›è®¿æ—¶é—´"
          readonly
          is-link
          bind:click="selectVisitTime"
        />
      </view>
      
      <view class="form-item">
        <text class="form-label">å›è®¿ç±»å‹</text>
        <van-field
          value="{{ scheduleVisitForm.typeText }}"
          placeholder="é€‰æ‹©å›è®¿ç±»å‹"
          readonly
          is-link
          bind:click="selectScheduleVisitType"
        />
      </view>
      
      <view class="form-item">
        <text class="form-label">å›è®¿ç›®çš„</text>
        <van-field
          value="{{ scheduleVisitForm.purpose }}"
          type="textarea"
          placeholder="è¯·è¾“å…¥å›è®¿ç›®çš„"
          autosize
          bind:change="onScheduleVisitInput"
          data-field="purpose"
        />
      </view>
      
      <view class="form-item">
        <view class="checkbox-item">
          <van-checkbox 
            value="{{ scheduleVisitForm.reminder }}"
            bind:change="onReminderChange"
          >
            æå‰æé†’
          </van-checkbox>
        </view>
      </view>
    </view>
  </van-dialog>

  <!-- å¢å€¼æœåŠ¡æ¨å¹¿å¼¹çª— -->
  <van-dialog
    use-slot
    title="å¢å€¼æœåŠ¡æ¨å¹¿"
    show="{{ showPromoteServiceDialog }}"
    bind:close="closePromoteServiceDialog"
    confirmButtonText="å‘é€æ¨å¹¿"
    bind:confirm="confirmPromoteService"
  >
    <view class="promote-service-dialog">
      <view class="form-item">
        <text class="form-label">é€‰æ‹©å®¢æˆ·</text>
        <van-field
          value="{{ promoteServiceForm.customerName }}"
          placeholder="è¯·é€‰æ‹©å®¢æˆ·"
          readonly
          is-link
          bind:click="selectCustomerForPromotion"
        />
      </view>
      
      <view class="form-item">
        <text class="form-label">æ¨å¹¿äº§å“</text>
        <van-field
          value="{{ promoteServiceForm.productName }}"
          placeholder="é€‰æ‹©æ¨å¹¿äº§å“"
          readonly
          is-link
          bind:click="selectPromotionProduct"
        />
      </view>
      
      <view class="form-item">
        <text class="form-label">æ¨å¹¿å†…å®¹</text>
        <van-field
          value="{{ promoteServiceForm.content }}"
          type="textarea"
          placeholder="è¯·è¾“å…¥æ¨å¹¿å†…å®¹"
          autosize
          bind:change="onPromoteServiceInput"
          data-field="content"
        />
      </view>
      
      <view class="form-item">
        <text class="form-label">ä¼˜æƒ ä¿¡æ¯</text>
        <van-field
          value="{{ promoteServiceForm.discount }}"
          placeholder="è¾“å…¥ä¼˜æƒ ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰"
          bind:change="onPromoteServiceInput"
          data-field="discount"
        />
      </view>
    </view>
  </van-dialog>

  <!-- å®¢æˆ·é€‰æ‹©å™¨ -->
  <van-action-sheet
    show="{{ showCustomerPicker }}"
    actions="{{ customerOptions }}"
    bind:close="closeCustomerPicker"
    bind:select="onCustomerSelect"
    cancel-text="å–æ¶ˆ"
  />

  <!-- å›è®¿æ–¹å¼é€‰æ‹©å™¨ -->
  <van-action-sheet
    show="{{ showVisitTypePicker }}"
    actions="{{ visitTypeOptions }}"
    bind:close="closeVisitTypePicker"
    bind:select="onVisitTypeSelect"
    cancel-text="å–æ¶ˆ"
  />

  <!-- äº§å“é€‰æ‹©å™¨ -->
  <van-action-sheet
    show="{{ showProductPicker }}"
    actions="{{ productOptions }}"
    bind:close="closeProductPicker"
    bind:select="onProductSelect"
    cancel-text="å–æ¶ˆ"
  />

  <!-- æ—¥æœŸæ—¶é—´é€‰æ‹©å™¨ -->
  <van-datetime-picker
    show="{{ showDateTimePicker }}"
    type="datetime"
    value="{{ pickerDateTime }}"
    min-date="{{ minDateTime }}"
    bind:confirm="onDateTimeConfirm"
    bind:cancel="closeDateTimePicker"
  />

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-overlay" wx:if="{{loading}}">
    <van-loading size="24px">åŠ è½½ä¸­...</van-loading>
  </view>
</view> 