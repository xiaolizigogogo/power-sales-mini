<!--pages/manager/customers/customers.wxml-->
<view class="container">
  <!-- æœç´¢æ  -->
  <view class="search-bar">
    <view class="search-input-wrapper">
      <text class="search-icon">ğŸ”</text>
      <input 
        class="search-input"
        placeholder="æœç´¢å®¢æˆ·åç§°ã€å…¬å¸åç§°"
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        bindconfirm="onSearchSubmit"
      />
      <view class="search-clear {{searchKeyword ? 'show' : ''}}" bindtap="onSearchClear">
        <text>âœ•</text>
      </view>
    </view>
    <view class="filter-btn" bindtap="onFilterTap">
      <text>âš™ï¸</text>
    </view>
  </view>

  <!-- çŠ¶æ€æ ‡ç­¾æ  -->
  <scroll-view class="tab-bar" scroll-x="true">
    <view class="tab-list">
      <view 
        class="tab-item {{currentTab === item.key ? 'active' : ''}}"
        wx:for="{{tabs}}"
        wx:key="key"
        data-key="{{item.key}}"
        bindtap="onTabChange"
      >
        <text class="tab-name">{{item.name}}</text>
        <text class="tab-count" wx:if="{{item.count > 0}}">({{item.count}})</text>
      </view>
    </view>
  </scroll-view>

  <!-- å®¢æˆ·åˆ—è¡¨ -->
  <view class="customer-list-container">
    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-wrapper" wx:if="{{loading && customers.length === 0}}">
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{!loading && customers.length === 0}}">
      <text class="empty-icon">ğŸ‘¥</text>
      <text class="empty-text">æš‚æ— å®¢æˆ·</text>
      <text class="empty-desc">è¿˜æ²¡æœ‰å®¢æˆ·æ•°æ®ï¼Œå¿«å»æ·»åŠ å§~</text>
      <button class="empty-btn" bindtap="onAddCustomerTap">æ·»åŠ å®¢æˆ·</button>
    </view>

    <!-- å®¢æˆ·åˆ—è¡¨ -->
    <view class="customer-list" wx:if="{{customers.length > 0}}">
      <view 
        class="customer-item"
        wx:for="{{customers}}"
        wx:key="id"
        data-customer="{{item}}"
        bindtap="onCustomerTap"
        bindlongpress="onCustomerLongPress"
      >
        <!-- å®¢æˆ·å¤´åƒå’ŒåŸºæœ¬ä¿¡æ¯ -->
        <view class="customer-header">
          <view class="avatar-wrapper">
            <view class="customer-avatar" wx:if="{{!item.avatar_url}}">ğŸ‘¤</view>
            <image class="customer-avatar" wx:else src="{{item.avatar_url}}" mode="aspectFill"></image>
          </view>
          <view class="customer-info">
            <view class="info-main">
              <view class="customer-name">{{item.name}}</view>
              <view class="customer-status">
                <text class="status-tag" style="background-color: {{item.status_config.color}};">
                  {{item.status_config.text}}
                </text>
              </view>
            </view>
            <view class="company-name">{{item.company_name}}</view>
            <view class="customer-meta">
              <text class="meta-item">{{item.phone}}</text>
              <text class="meta-separator">|</text>
              <text class="meta-item">{{item.industry || 'æœªçŸ¥è¡Œä¸š'}}</text>
            </view>
          </view>
        </view>

        <!-- å®¢æˆ·ç»Ÿè®¡ä¿¡æ¯ -->
        <view class="customer-stats">
          <view class="stat-item">
            <text class="stat-label">æœ€åè”ç³»</text>
            <text class="stat-value">{{item.last_contact_time_text}}</text>
          </view>
          <view class="stat-item">
            <text class="stat-label">è”ç³»æ¬¡æ•°</text>
            <text class="stat-value">{{item.contact_count_text}}</text>
          </view>
          <view class="stat-item">
            <text class="stat-label">è®¢å•é‡‘é¢</text>
            <text class="stat-value money">{{item.total_amount_text}}</text>
          </view>
        </view>

        <!-- å¿«æ·æ“ä½œ -->
        <view class="customer-actions">
          <button 
            class="action-btn primary"
            catchtap="onCallTap"
            data-phone="{{item.phone}}"
          >
            ğŸ“ æ‹¨æ‰“
          </button>
          <button 
            class="action-btn secondary"
            catchtap="onWechatTap"
            data-customer-id="{{item.id}}"
          >
            ğŸ’¬ å¾®ä¿¡
          </button>
          <button 
            class="action-btn secondary"
            catchtap="onQuickFollowTap"
            data-customer-id="{{item.id}}"
          >
            ğŸ“ è·Ÿè¿›
          </button>
        </view>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view class="load-more" wx:if="{{hasMore && customers.length > 0}}">
      <text class="load-more-text" wx:if="{{loadingMore}}">åŠ è½½ä¸­...</text>
      <text class="load-more-text" wx:else>ä¸Šæ‹‰åŠ è½½æ›´å¤š</text>
    </view>

    <!-- æ²¡æœ‰æ›´å¤šæ•°æ® -->
    <view class="no-more" wx:if="{{!hasMore && customers.length > 0}}">
      <text>å·²æ˜¾ç¤ºå…¨éƒ¨å®¢æˆ·</text>
    </view>
  </view>

  <!-- ç­›é€‰é¢æ¿ -->
  <view class="filter-panel {{showFilterPanel ? 'show' : ''}}" catchtap="onFilterPanelClose">
    <view class="filter-content" catchtap="">
      <view class="filter-header">
        <text class="filter-title">ç­›é€‰æ¡ä»¶</text>
        <text class="filter-reset" bindtap="onFilterReset">é‡ç½®</text>
      </view>

      <!-- è¡Œä¸šç­›é€‰ -->
      <view class="filter-section">
        <text class="filter-section-title">è¡Œä¸šç±»å‹</text>
        <view class="filter-options">
          <view 
            class="filter-option {{selectedIndustry === item.value ? 'selected' : ''}}"
            wx:for="{{filterOptions.industries}}"
            wx:key="value"
            data-value="{{item.value}}"
            bindtap="onIndustryChange"
          >
            <text>{{item.label}}</text>
          </view>
        </view>
      </view>

      <!-- ä¼ä¸šè§„æ¨¡ç­›é€‰ -->
      <view class="filter-section">
        <text class="filter-section-title">ä¼ä¸šè§„æ¨¡</text>
        <view class="filter-options">
          <view 
            class="filter-option {{selectedScale === item.value ? 'selected' : ''}}"
            wx:for="{{filterOptions.scales}}"
            wx:key="value"
            data-value="{{item.value}}"
            bindtap="onScaleChange"
          >
            <text>{{item.label}}</text>
          </view>
        </view>
      </view>

      <!-- ç­›é€‰æŒ‰é’® -->
      <view class="filter-actions">
        <button class="filter-cancel" bindtap="onFilterPanelClose">å–æ¶ˆ</button>
        <button class="filter-apply" bindtap="onFilterApply">ç¡®å®š</button>
      </view>
    </view>
  </view>

  <!-- æµ®åŠ¨æ“ä½œæŒ‰é’® -->
  <view class="fab-container">
    <view class="fab-btn" bindtap="onAddCustomerTap">
      <text class="fab-icon">â•</text>
    </view>
  </view>
</view>