<!--pages/manager/follow/list.wxml-->
<permission-guard required-user-type="manager" required-page="follow">
  <view class="follow-list-container">
    <!-- å¤´éƒ¨ç»Ÿè®¡ä¿¡æ¯ -->
    <view class="header-stats">
      <view class="stat-item">
        <text class="stat-number">{{totalCount}}</text>
        <text class="stat-label">æ€»è·Ÿè¿›æ•°</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{todayCount}}</text>
        <text class="stat-label">ä»Šæ—¥è·Ÿè¿›</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{weekCount}}</text>
        <text class="stat-label">æœ¬å‘¨è·Ÿè¿›</text>
      </view>
      <view class="stat-item">
        <text class="stat-number text-danger">{{overdueCount}}</text>
        <text class="stat-label">é€¾æœŸæé†’</text>
      </view>
    </view>

    <!-- æœç´¢æ  -->
    <view class="search-bar">
      <view class="search-box">
        <image class="search-icon" src="/assets/images/icons/search.png" mode="aspectFit"></image>
        <input 
          class="search-input" 
          placeholder="æœç´¢å®¢æˆ·å§“åã€è·Ÿè¿›å†…å®¹"
          value="{{searchKeyword}}"
          bindinput="onSearchInput"
          confirm-type="search"
        />
        <view class="clear-btn" wx:if="{{searchKeyword}}" bindtap="onClearSearch">
          <image src="/assets/images/icons/close.png" mode="aspectFit"></image>
        </view>
      </view>
      <view class="filter-btn" bindtap="onShowFilter">
        <image src="/assets/images/icons/filter.png" mode="aspectFit"></image>
      </view>
    </view>

    <!-- çŠ¶æ€æ ‡ç­¾åˆ‡æ¢ -->
    <scroll-view class="status-tabs" scroll-x="{{true}}" show-scrollbar="{{false}}">
      <view class="tab-container">
        <view 
          class="tab-item {{activeTab === item.value ? 'active' : ''}} {{item.value === 'overdue' ? 'danger' : ''}}"
          wx:for="{{tabOptions}}" 
          wx:key="value"
          data-tab="{{item.value}}"
          bindtap="onTabChange"
        >
          <text class="tab-label">{{item.label}}</text>
          <text class="tab-count">{{item.count}}</text>
        </view>
      </view>
    </scroll-view>

    <!-- è·Ÿè¿›åˆ—è¡¨ -->
    <view class="follow-list">
      <view 
        class="follow-item {{item.isOverdue ? 'overdue' : ''}}"
        wx:for="{{followList}}" 
        wx:key="id"
        data-id="{{item.id}}"
        bindtap="onFollowTap"
      >
        <!-- è·Ÿè¿›ç±»å‹å›¾æ ‡ -->
        <view class="follow-type-icon {{item.followType}}">
          <text class="type-text">
            {{item.followType === 'phone' ? 'ğŸ“' : 
              item.followType === 'visit' ? 'ğŸš¶' : 
              item.followType === 'wechat' ? 'ğŸ’¬' : 'ğŸ“§'}}
          </text>
        </view>
        
        <!-- è·Ÿè¿›å†…å®¹ -->
        <view class="follow-content">
          <view class="follow-header">
            <view class="customer-info">
              <text class="customer-name">{{item.customerName}}</text>
              <text class="customer-company">{{item.customerCompany}}</text>
            </view>
            <view class="follow-status {{item.status}}">
              <text class="status-text">{{item.statusName}}</text>
            </view>
          </view>
          
          <view class="follow-detail">
            <text class="follow-title">{{item.title}}</text>
            <text class="follow-content-text">{{item.content}}</text>
          </view>
          
          <view class="follow-meta">
            <view class="meta-left">
              <text class="follow-time">è·Ÿè¿›æ—¶é—´: {{item.followTime}}</text>
              <text class="priority priority-{{item.priority}}">{{item.priorityName}}ä¼˜å…ˆçº§</text>
            </view>
            
            <view class="meta-right" wx:if="{{item.nextFollowTime}}">
              <text class="next-follow">ä¸‹æ¬¡è·Ÿè¿›: {{item.nextFollowTime}}</text>
            </view>
          </view>
          
          <!-- æ ‡ç­¾ -->
          <view class="follow-tags" wx:if="{{item.tags.length > 0}}">
            <text class="tag" wx:for="{{item.tags}}" wx:key="*this" wx:for-item="tag">{{tag}}</text>
          </view>
          
          <!-- é™„ä»¶ -->
          <view class="attachments" wx:if="{{item.attachments.length > 0}}">
            <image class="attachment-icon" src="/assets/images/icons/attachment.png" mode="aspectFit"></image>
            <text class="attachment-count">{{item.attachments.length}}ä¸ªé™„ä»¶</text>
          </view>
        </view>
        
        <!-- æ“ä½œæŒ‰é’® -->
        <view class="follow-actions">
          <view class="action-top">
            <view 
              class="contact-btn"
              data-phone="{{item.customerPhone}}"
              data-wechat="{{item.customerWechat}}"
              bindtap="onQuickContact"
            >
              <image src="/assets/images/icons/phone.png" mode="aspectFit"></image>
            </view>
          </view>
          
          <view class="action-bottom" wx:if="{{item.status === 'pending'}}">
            <view 
              class="complete-btn"
              data-id="{{item.id}}"
              bindtap="onCompleteFollow"
            >
              <text>å®Œæˆ</text>
            </view>
            <view 
              class="delay-btn"
              data-id="{{item.id}}"
              bindtap="onDelayFollow"
            >
              <text>å»¶æœŸ</text>
            </view>
          </view>
        </view>
      </view>
      
      <!-- åŠ è½½æ›´å¤š -->
      <view class="load-more" wx:if="{{hasMore && !loading}}">
        <text>ä¸Šæ‹‰åŠ è½½æ›´å¤š</text>
      </view>
      
      <!-- åŠ è½½ä¸­ -->
      <view class="loading" wx:if="{{loading}}">
        <text>åŠ è½½ä¸­...</text>
      </view>
      
      <!-- æš‚æ— æ•°æ® -->
      <view class="empty-state" wx:if="{{!loading && followList.length === 0}}">
        <image src="/assets/images/empty-follow.png" mode="aspectFit"></image>
        <text class="empty-text">æš‚æ— è·Ÿè¿›è®°å½•</text>
        <view class="add-follow-btn" bindtap="onAddFollow">
          <text>æ·»åŠ è·Ÿè¿›</text>
        </view>
      </view>
    </view>

    <!-- ç­›é€‰å¼¹çª— -->
    <view class="filter-modal" wx:if="{{showFilterModal}}">
      <view class="modal-mask" bindtap="onHideFilter"></view>
      <view class="modal-content">
        <view class="modal-header">
          <text class="modal-title">ç­›é€‰æ¡ä»¶</text>
          <view class="close-btn" bindtap="onHideFilter">
            <image src="/assets/images/icons/close.png" mode="aspectFit"></image>
          </view>
        </view>
        
        <view class="filter-content">
          <!-- è·Ÿè¿›ç±»å‹ -->
          <view class="filter-section">
            <text class="filter-label">è·Ÿè¿›ç±»å‹</text>
            <view class="filter-options">
              <view class="option-item">å…¨éƒ¨</view>
              <view class="option-item">ç”µè¯è·Ÿè¿›</view>
              <view class="option-item">å®åœ°æ‹œè®¿</view>
              <view class="option-item">å¾®ä¿¡æ²Ÿé€š</view>
              <view class="option-item">é‚®ä»¶è”ç³»</view>
            </view>
          </view>
          
          <!-- è·Ÿè¿›çŠ¶æ€ -->
          <view class="filter-section">
            <text class="filter-label">è·Ÿè¿›çŠ¶æ€</text>
            <view class="filter-options">
              <view class="option-item">å…¨éƒ¨</view>
              <view class="option-item">å¾…è·Ÿè¿›</view>
              <view class="option-item">å·²å®Œæˆ</view>
              <view class="option-item">å·²å–æ¶ˆ</view>
            </view>
          </view>
          
          <!-- ä¼˜å…ˆçº§ -->
          <view class="filter-section">
            <text class="filter-label">ä¼˜å…ˆçº§</text>
            <view class="filter-options">
              <view class="option-item">å…¨éƒ¨</view>
              <view class="option-item">é«˜ä¼˜å…ˆçº§</view>
              <view class="option-item">ä¸­ä¼˜å…ˆçº§</view>
              <view class="option-item">ä½ä¼˜å…ˆçº§</view>
            </view>
          </view>
        </view>
        
        <view class="modal-footer">
          <view class="reset-btn" bindtap="onClearFilter">é‡ç½®</view>
          <view class="confirm-btn" bindtap="onApplyFilter">ç¡®å®š</view>
        </view>
      </view>
    </view>

    <!-- æµ®åŠ¨æ·»åŠ æŒ‰é’® -->
    <view class="floating-add-btn" bindtap="onAddFollow">
      <image src="/assets/images/icons/add-white.png" mode="aspectFit"></image>
    </view>
  </view>
</permission-guard> 