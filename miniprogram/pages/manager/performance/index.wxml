<!--pages/manager/performance/index.wxml-->
<permission-guard required-user-type="manager" required-page="/pages/manager/performance/index">
  <view class="performance-container">
    <!-- æ—¶é—´å‘¨æœŸé€‰æ‹© -->
    <view class="period-selector">
      <view 
        class="period-item {{selectedPeriod === item.value ? 'active' : ''}}"
        wx:for="{{periodOptions}}" 
        wx:key="value"
        data-period="{{item.value}}"
        bindtap="onPeriodChange"
      >
        <text>{{item.label}}</text>
      </view>
    </view>

    <!-- ä¸ªäººä¸šç»©æ¦‚è§ˆ -->
    <view class="performance-overview">
      <view class="overview-header">
        <text class="section-title">ä¸ªäººä¸šç»©</text>
        <view class="ranking-badge">
          <text class="ranking-text">å›¢é˜Ÿæ’å {{personalPerformance.ranking}}/{{personalPerformance.totalEmployees}}</text>
        </view>
      </view>
      
      <view class="performance-main">
        <view class="amount-section">
          <text class="current-amount">Â¥{{personalPerformance.currentAmount}}</text>
          <view class="amount-details">
            <text class="target-text">ç›®æ ‡: Â¥{{personalPerformance.targetAmount}}</text>
            <text class="completion-rate {{personalPerformance.completionRate >= 80 ? 'good' : 'warning'}}">
              å®Œæˆç‡ {{personalPerformance.completionRate}}%
            </text>
          </view>
        </view>
        
        <view class="growth-section">
          <view class="growth-indicator {{personalPerformance.growth >= 0 ? 'positive' : 'negative'}}">
            <text class="growth-icon">{{personalPerformance.growth >= 0 ? 'â†—' : 'â†˜'}}</text>
            <text class="growth-text">{{personalPerformance.growth >= 0 ? '+' : ''}}{{personalPerformance.growth}}%</text>
          </view>
          <text class="growth-label">è¾ƒä¸Šæœˆ</text>
        </view>
      </view>
      
      <!-- è¿›åº¦æ¡ -->
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{personalPerformance.completionRate}}%"></view>
      </view>
    </view>

    <!-- æœˆåº¦ç›®æ ‡è¿›åº¦ -->
    <view class="monthly-target">
      <view class="section-header">
        <text class="section-title">æœˆåº¦ç›®æ ‡è¿›åº¦</text>
        <text class="target-status {{monthlyTarget.onTrack ? 'on-track' : 'behind'}}">
          {{monthlyTarget.onTrack ? 'è¿›åº¦æ­£å¸¸' : 'éœ€è¦åŠ é€Ÿ'}}
        </text>
      </view>
      
      <view class="target-content">
        <view class="target-numbers">
          <view class="target-item">
            <text class="target-value">Â¥{{monthlyTarget.remaining}}</text>
            <text class="target-label">è¿˜éœ€å®Œæˆ</text>
          </view>
          <view class="target-item">
            <text class="target-value">{{monthlyTarget.daysLeft}}</text>
            <text class="target-label">å‰©ä½™å¤©æ•°</text>
          </view>
          <view class="target-item">
            <text class="target-value">Â¥{{monthlyTarget.dailyRequired}}</text>
            <text class="target-label">æ—¥å‡éœ€å®Œæˆ</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ä¸šç»©åˆ†è§£ -->
    <view class="performance-breakdown">
      <view class="section-header">
        <text class="section-title">ä¸šç»©åˆ†è§£</text>
        <text class="more-btn" bindtap="onViewDetailReport">è¯¦ç»†æŠ¥å‘Š</text>
      </view>
      
      <view class="breakdown-grid">
        <view class="breakdown-item">
          <text class="breakdown-number">{{performanceBreakdown.newCustomers}}</text>
          <text class="breakdown-label">æ–°å®¢æˆ·</text>
          <text class="breakdown-amount">Â¥{{performanceBreakdown.newCustomerAmount}}</text>
        </view>
        <view class="breakdown-item">
          <text class="breakdown-number">{{performanceBreakdown.renewalCustomers}}</text>
          <text class="breakdown-label">ç»­çº¦å®¢æˆ·</text>
          <text class="breakdown-amount">Â¥{{performanceBreakdown.renewalAmount}}</text>
        </view>
        <view class="breakdown-item">
          <text class="breakdown-number">Â¥{{performanceBreakdown.averageOrderValue}}</text>
          <text class="breakdown-label">å¹³å‡è®¢å•é‡‘é¢</text>
        </view>
        <view class="breakdown-item">
          <text class="breakdown-number">{{performanceBreakdown.conversionRate}}%</text>
          <text class="breakdown-label">è½¬åŒ–ç‡</text>
        </view>
      </view>
    </view>

    <!-- å†å²è¶‹åŠ¿å›¾è¡¨ -->
    <view class="trend-chart">
      <view class="section-header">
        <text class="section-title">ä¸šç»©è¶‹åŠ¿</text>
        <view class="chart-controls">
          <text 
            class="chart-btn {{chartType === 'trend' ? 'active' : ''}}"
            data-type="trend"
            bindtap="onChartTypeChange"
          >è¶‹åŠ¿</text>
          <text 
            class="chart-btn {{chartType === 'breakdown' ? 'active' : ''}}"
            data-type="breakdown"
            bindtap="onChartTypeChange"
          >åˆ†è§£</text>
        </view>
      </view>
      
      <view class="chart-content">
        <!-- ç®€åŒ–çš„è¶‹åŠ¿å›¾è¡¨ -->
        <view class="trend-list">
          <view 
            class="trend-item"
            wx:for="{{trendData}}" 
            wx:key="month"
          >
            <text class="trend-month">{{item.month}}</text>
            <view class="trend-bar">
              <view 
                class="trend-fill"
                style="height: {{item.amount / 150000 * 100}}%"
              ></view>
            </view>
            <text class="trend-amount">Â¥{{item.amount}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- å›¢é˜Ÿæ’è¡Œæ¦œ -->
    <view class="team-ranking">
      <view class="section-header">
        <text class="section-title">å›¢é˜Ÿæ’è¡Œæ¦œ</text>
        <text class="more-btn" bindtap="onViewTeamDetail">æŸ¥çœ‹å…¨éƒ¨</text>
      </view>
      
      <view class="ranking-list">
        <view 
          class="ranking-item {{item.isMe ? 'highlight' : ''}}"
          wx:for="{{teamRanking}}" 
          wx:key="rank"
          wx:if="{{index < 5}}"
        >
          <view class="ranking-info">
            <view class="rank-badge rank-{{item.rank <= 3 ? item.rank : 'other'}}">
              <text class="rank-number">{{item.rank}}</text>
            </view>
            <text class="member-name">{{item.name}}</text>
          </view>
          
          <view class="performance-info">
            <text class="member-amount">Â¥{{item.amount}}</text>
            <text class="member-growth {{item.growth >= 0 ? 'positive' : 'negative'}}">
              {{item.growth >= 0 ? '+' : ''}}{{item.growth}}%
            </text>
          </view>
        </view>
      </view>
    </view>

    <!-- ä¸šç»©åˆ†æ -->
    <view class="performance-analysis">
      <text class="section-title">ä¸šç»©åˆ†æ</text>
      
      <view class="analysis-content">
        <view class="analysis-item">
          <text class="analysis-label">æœ€ä½³è¡¨ç°æœˆä»½</text>
          <text class="analysis-value">{{performanceAnalysis.bestPerformingMonth}}</text>
        </view>
        <view class="analysis-item">
          <text class="analysis-label">ä¼˜åŠ¿é¢†åŸŸ</text>
          <text class="analysis-value">{{performanceAnalysis.topCategory}}</text>
        </view>
        <view class="analysis-item">
          <text class="analysis-label">æ”¹è¿›å»ºè®®</text>
          <view class="improvement-tags">
            <text 
              class="improvement-tag"
              wx:for="{{performanceAnalysis.improvementAreas}}" 
              wx:key="*this"
            >{{item}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="action-buttons">
      <view class="action-btn primary" bindtap="onViewHistory">
        <view class="btn-icon">ğŸ“Š</view>
        <text>å†å²è®°å½•</text>
      </view>
      <view class="action-btn secondary" bindtap="onSetTarget">
        <view class="btn-icon">ğŸ¯</view>
        <text>è®¾ç½®ç›®æ ‡</text>
      </view>
      <view class="action-btn secondary" bindtap="onExportReport">
        <view class="btn-icon">ğŸ“¥</view>
        <text>å¯¼å‡ºæŠ¥å‘Š</text>
      </view>
      <view class="action-btn secondary" bindtap="onSharePerformance">
        <view class="btn-icon">ğŸ“¤</view>
        <text>åˆ†äº«ä¸šç»©</text>
      </view>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-overlay" wx:if="{{loading}}">
      <view class="loading-spinner">
        <text>åŠ è½½ä¸­...</text>
      </view>
    </view>
  </view>
</permission-guard> 