<!-- ä¸šç»©ç»Ÿè®¡é¡µé¢ -->
<view class="performance-container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <view class="header-title">ä¸šç»©ç»Ÿè®¡</view>
    <view class="header-actions">
      <view class="action-btn" bindtap="showShareModal">
        <image src="/images/icons/share.png" class="action-icon" />
      </view>
      <view class="action-btn" bindtap="exportData">
        <image src="/images/icons/export.png" class="action-icon" />
      </view>
      <view class="action-btn" bindtap="setReminder">
        <image src="/images/icons/reminder.png" class="action-icon" />
      </view>
    </view>
  </view>

  <!-- æ—¶é—´ç­›é€‰ -->
  <view class="time-filter">
    <view class="filter-tabs">
      <view 
        wx:for="{{periodOptions}}" 
        wx:key="value"
        class="filter-tab {{currentPeriod === item.value ? 'active' : ''}}"
        data-period="{{item.value}}"
        bindtap="onPeriodChange"
      >
        {{item.label}}
      </view>
    </view>
    
    <view class="custom-date">
      <view class="date-picker" bindtap="showDatePicker" data-type="start">
        <text class="date-text">{{customDateRange.startDate || 'å¼€å§‹æ—¥æœŸ'}}</text>
        <image src="/images/icons/calendar.png" class="date-icon" />
      </view>
      <view class="date-separator">è‡³</view>
      <view class="date-picker" bindtap="showDatePicker" data-type="end">
        <text class="date-text">{{customDateRange.endDate || 'ç»“æŸæ—¥æœŸ'}}</text>
        <image src="/images/icons/calendar.png" class="date-icon" />
      </view>
    </view>
  </view>

  <!-- å†…å®¹åŒºåŸŸ -->
  <view class="content-container">
    <!-- æ ‡ç­¾é¡µ -->
    <view class="tabs">
      <view 
        wx:for="{{tabs}}" 
        wx:key="key"
        class="tab-item {{activeTab === index ? 'active' : ''}}"
        data-index="{{index}}"
        bindtap="onTabChange"
      >
        {{item.title}}
      </view>
    </view>

    <!-- ä¸šç»©æ¦‚è§ˆ -->
    <view wx:if="{{activeTab === 0}}" class="tab-content">
      <!-- æ ¸å¿ƒæŒ‡æ ‡å¡ç‰‡ -->
      <view class="metrics-grid">
        <view class="metric-card">
          <view class="metric-value">{{performanceData.overview.totalCustomers}}</view>
          <view class="metric-label">æ€»å®¢æˆ·æ•°</view>
          <view class="metric-change positive">
            <image src="/images/icons/arrow-up.png" class="change-icon" />
            +{{performanceData.overview.newCustomers}}
          </view>
        </view>
        
        <view class="metric-card">
          <view class="metric-value">{{performanceData.overview.totalOrders}}</view>
          <view class="metric-label">æ€»è®¢å•æ•°</view>
          <view class="metric-change positive">
            <image src="/images/icons/arrow-up.png" class="change-icon" />
            +{{performanceData.overview.signedCustomers}}
          </view>
        </view>
        
        <view class="metric-card">
          <view class="metric-value">{{formatAmount(performanceData.overview.totalAmount)}}</view>
          <view class="metric-label">æ€»è®¢å•é‡‘é¢</view>
          <view class="metric-change positive">
            <image src="/images/icons/arrow-up.png" class="change-icon" />
            {{formatPercent(performanceData.overview.achievementRate)}}
          </view>
        </view>
        
        <view class="metric-card">
          <view class="metric-value">{{performanceData.overview.ranking}}</view>
          <view class="metric-label">ä¸ªäººæ’å</view>
          <view class="metric-change">
            å®Œæˆç‡{{formatPercent(performanceData.overview.completionRate)}}
          </view>
        </view>
      </view>

      <!-- ç›®æ ‡å®Œæˆè¿›åº¦ -->
      <view class="progress-section">
        <view class="section-title">
          <text>ç›®æ ‡å®Œæˆè¿›åº¦</text>
          <text class="target-action" bindtap="setTarget">è®¾ç½®ç›®æ ‡</text>
        </view>
        <view class="progress-card">
          <view class="progress-info">
            <view class="progress-text">
              <text class="current-amount">{{formatAmount(performanceData.overview.totalAmount)}}</text>
              <text class="target-amount">/ {{formatAmount(performanceData.overview.targetAmount)}}</text>
            </view>
            <view class="progress-percent">{{formatPercent(performanceData.overview.achievementRate)}}</view>
          </view>
          <view class="progress-bar">
            <view class="progress-fill" style="width: {{performanceData.overview.achievementRate}}%"></view>
          </view>
        </view>
      </view>

      <!-- å¿«é€Ÿæ“ä½œ -->
      <view class="quick-actions">
        <view class="action-grid">
          <view class="action-item" bindtap="viewCustomerDistribution" data-type="byStatus">
            <image src="/images/icons/customers.png" class="action-icon" />
            <text class="action-text">å®¢æˆ·åˆ†å¸ƒ</text>
          </view>
          <view class="action-item" bindtap="viewDetailAnalysis" data-type="order">
            <image src="/images/icons/orders.png" class="action-icon" />
            <text class="action-text">è®¢å•åˆ†æ</text>
          </view>
          <view class="action-item" bindtap="viewDetailAnalysis" data-type="follow">
            <image src="/images/icons/follow.png" class="action-icon" />
            <text class="action-text">è·Ÿè¿›æ•ˆç‡</text>
          </view>
          <view class="action-item" bindtap="viewTargetDetail">
            <image src="/images/icons/target.png" class="action-icon" />
            <text class="action-text">ç›®æ ‡ç®¡ç†</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æ•°æ®åˆ†æ -->
    <view wx:if="{{activeTab === 1}}" class="tab-content">
      <!-- è¶‹åŠ¿å›¾è¡¨ -->
      <view class="chart-section">
        <view class="section-title">ä¸šç»©è¶‹åŠ¿</view>
        <view class="chart-container">
          <ec-canvas id="trend-chart" canvas-id="trendChart" ec="{{chartOptions.trend}}"></ec-canvas>
        </view>
      </view>

      <!-- å®¢æˆ·åˆ†å¸ƒ -->
      <view class="chart-section">
        <view class="section-title">å®¢æˆ·åˆ†å¸ƒ</view>
        <view class="distribution-tabs">
          <view class="dist-tab active">æŒ‰çŠ¶æ€</view>
          <view class="dist-tab">æŒ‰è¡Œä¸š</view>
          <view class="dist-tab">æŒ‰åœ°åŒº</view>
        </view>
        <view class="chart-container">
          <ec-canvas id="dist-chart" canvas-id="distChart" ec="{{chartOptions.distribution}}"></ec-canvas>
        </view>
      </view>

      <!-- è¯¦ç»†æ•°æ® -->
      <view class="data-section">
        <view class="section-title">è¯¦ç»†æ•°æ®</view>
        <view class="data-grid">
          <view class="data-item">
            <view class="data-label">å¹³å‡å®¢å•ä»·</view>
            <view class="data-value">{{formatAmount(performanceData.orderAnalysis.avgOrderValue)}}</view>
          </view>
          <view class="data-item">
            <view class="data-label">è½¬åŒ–ç‡</view>
            <view class="data-value">{{formatPercent(performanceData.orderAnalysis.conversionRate)}}</view>
          </view>
          <view class="data-item">
            <view class="data-label">å®¢æˆ·æ»¡æ„åº¦</view>
            <view class="data-value">{{performanceData.followEfficiency.customerSatisfaction}}åˆ†</view>
          </view>
          <view class="data-item">
            <view class="data-label">å¹³å‡å“åº”æ—¶é—´</view>
            <view class="data-value">{{performanceData.followEfficiency.avgResponseTime}}å°æ—¶</view>
          </view>
        </view>
      </view>
    </view>

    <!-- æ’è¡Œæ¦œ -->
    <view wx:if="{{activeTab === 2}}" class="tab-content">
      <!-- ä¸ªäººæ’è¡Œ -->
      <view class="ranking-section">
        <view class="section-title">
          <text>ä¸ªäººæ’è¡Œæ¦œ</text>
          <text class="ranking-action" bindtap="viewRankingDetail" data-type="personal">æŸ¥çœ‹æ›´å¤š</text>
        </view>
        <view class="ranking-list">
          <view 
            wx:for="{{rankings.personal}}" 
            wx:key="id"
            class="ranking-item {{index < 3 ? 'top-three' : ''}}"
          >
            <view class="ranking-position">
              <text wx:if="{{index < 3}}" class="medal">{{index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : 'ğŸ¥‰'}}</text>
              <text wx:else class="rank-number">{{index + 1}}</text>
            </view>
            <view class="ranking-info">
              <view class="employee-name">{{item.name}}</view>
              <view class="employee-dept">{{item.department}}</view>
            </view>
            <view class="ranking-data">
              <view class="data-primary">{{formatAmount(item.totalAmount)}}</view>
              <view class="data-secondary">{{item.customerCount}}å®¢æˆ·</view>
            </view>
          </view>
        </view>
      </view>

      <!-- å›¢é˜Ÿæ’è¡Œ -->
      <view class="ranking-section">
        <view class="section-title">
          <text>å›¢é˜Ÿæ’è¡Œæ¦œ</text>
          <text class="ranking-action" bindtap="viewRankingDetail" data-type="team">æŸ¥çœ‹æ›´å¤š</text>
        </view>
        <view class="ranking-list">
          <view 
            wx:for="{{rankings.team}}" 
            wx:key="id"
            class="ranking-item {{index < 3 ? 'top-three' : ''}}"
          >
            <view class="ranking-position">
              <text wx:if="{{index < 3}}" class="medal">{{index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : 'ğŸ¥‰'}}</text>
              <text wx:else class="rank-number">{{index + 1}}</text>
            </view>
            <view class="ranking-info">
              <view class="team-name">{{item.name}}</view>
              <view class="team-members">{{item.memberCount}}äºº</view>
            </view>
            <view class="ranking-data">
              <view class="data-primary">{{formatAmount(item.totalAmount)}}</view>
              <view class="data-secondary">{{item.orderCount}}è®¢å•</view>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">æ•°æ®åŠ è½½ä¸­...</text>
  </view>
</view>

<!-- æ—¥æœŸé€‰æ‹©å™¨ -->
<picker
  wx:if="{{showDatePicker}}"
  mode="date"
  value="{{datePickerType === 'start' ? customDateRange.startDate : customDateRange.endDate}}"
  bindchange="onDateConfirm"
  bindcancel="onDateCancel"
>
  <view class="date-picker-mask"></view>
</picker>

<!-- åˆ†äº«å¼¹çª— -->
<view wx:if="{{showShareModal}}" class="modal-overlay" bindtap="hideShareModal">
  <view class="share-modal" catchtap="">
    <view class="modal-header">
      <text class="modal-title">åˆ†äº«ä¸šç»©</text>
      <view class="modal-close" bindtap="hideShareModal">Ã—</view>
    </view>
    <view class="share-options">
      <view 
        wx:for="{{shareOptions}}" 
        wx:key="name"
        class="share-option"
        open-type="{{item.openType}}"
        data-action="{{item.action}}"
        bindtap="onShareAction"
      >
        <image src="/images/icons/{{item.icon}}.png" class="share-icon" />
        <text class="share-text">{{item.name}}</text>
      </view>
    </view>
  </view>
</view>

<!-- åº•éƒ¨æ“ä½œæ  -->
<view class="bottom-actions">
  <view class="action-button secondary" bindtap="refreshData">
    <image src="/images/icons/refresh.png" class="btn-icon" />
    <text>åˆ·æ–°æ•°æ®</text>
  </view>
  <view class="action-button primary" bindtap="exportData">
    <image src="/images/icons/download.png" class="btn-icon" />
    <text>å¯¼å‡ºæŠ¥å‘Š</text>
  </view>
</view> 